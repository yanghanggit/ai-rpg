from typing import List
from ..entitas import Processors


###################################################################################################################################################################
class RPGGameProcessPipeline(Processors):
    """
    RPGæ¸¸æˆæµç¨‹ç®¡é“

    ç®¡ç†æ¸¸æˆæµç¨‹ä¸­çš„å¤„ç†å™¨æ‰§è¡Œå’Œç”Ÿå‘½å‘¨æœŸ
    """

    def __init__(self) -> None:
        super().__init__()
        # logger.info("ğŸ® RPG æ¸¸æˆæµç¨‹ç®¡é“å·²åˆ›å»º")

    ###################################################################################################################################################################
    async def process(self) -> None:
        """æ‰§è¡Œç®¡é“ä¸­çš„æ‰€æœ‰å¤„ç†å™¨"""

        # æ‰§è¡Œå¤„ç†å™¨
        await self.execute()

        # æ¸…ç†å¤„ç†å™¨
        self.cleanup()

    ###############################################################################################################################################
    def shutdown(self) -> None:
        """å…³é—­ç®¡é“å¹¶æ¸…ç†èµ„æº"""

        # å…³é—­ç®¡é“
        self.tear_down()

        # æ¸…ç†ååº”å¼å¤„ç†å™¨
        self.clear_reactive_processors()


################################################################################################################################################
class RPGGamePipelineManager:
    """
    RPGæ¸¸æˆæµç¨‹ç®¡é“ç®¡ç†å™¨

    è´Ÿè´£ç®¡ç†å’Œåè°ƒæ‰€æœ‰æ¸¸æˆæµç¨‹ç®¡é“çš„ç”Ÿå‘½å‘¨æœŸ
    """

    def __init__(self) -> None:
        self._pipelines: List[RPGGameProcessPipeline] = []

    ###############################################################################################################################################
    def register_pipeline(self, pipeline: RPGGameProcessPipeline) -> None:
        """æ³¨å†Œä¸€ä¸ªæ¸¸æˆæµç¨‹ç®¡é“"""
        self._pipelines.append(pipeline)

    ###############################################################################################################################################
    async def initialize_pipelines(self) -> None:
        """åˆå§‹åŒ–æ‰€æœ‰å·²æ³¨å†Œçš„ç®¡é“"""

        for pipeline in self._pipelines:

            # æ¿€æ´»ååº”å¼å¤„ç†å™¨
            pipeline.activate_reactive_processors()

            # åˆå§‹åŒ–æ¯ä¸ªç®¡é“
            await pipeline.initialize()

    ###############################################################################################################################################
    def shutdown_pipelines(self) -> None:
        """å…³é—­æ‰€æœ‰ç®¡é“å¹¶æ¸…ç©ºç®¡é“åˆ—è¡¨"""

        for pipeline in self._pipelines:
            # å…³é—­æ¯ä¸ªç®¡é“
            pipeline.shutdown()

        # æ¸…ç©ºç®¡é“åˆ—è¡¨
        self._pipelines = []

    ###############################################################################################################################################
