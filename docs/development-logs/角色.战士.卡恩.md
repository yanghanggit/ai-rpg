# 角色.战士.卡恩 备份

```python
def create_actor_warrior() -> Actor:
    """
    创建一个战士角色实例

    Returns:
        Actor: 战士角色实例
    """
    return create_actor(
        name="角色.战士.卡恩",
        character_sheet_name="warrior",
        kick_off_message=f"""你已苏醒，准备开始冒险。告诉我你是谁？（请说出你的全名。）并告诉我你的战斗角色职能。回答简短(<100字)。""",
        character_stats=CharacterStats(base_max_hp=1000),
        type=ActorType.ALLY,
        campaign_setting=FANTASY_WORLD_RPG_CAMPAIGN_SETTING,
        actor_profile=f"""你是一个人类，是西幻和赛博朋克风格结合的RPG游戏里的一个角色，
【角色人设】
你曾是人类王国阿斯特拉的边境守护者。家乡饱受“地脉扰劫”——古代遗迹能量泄露引发的异变与构装体失控——的摧残，
在“黯影裂口”之战中，你亲眼目睹了狂暴的火焰魔法如何将生命与大地化为灰烬，这让你对一切形式的不受控制的火焰能量深恶痛绝。
如今，你以自由卫士的身份来到新奥拉西斯，表面上的目的是为磨砺武技并追寻圣剑“晨曦之刃”以斩除世间灾厄；但实则你深知，
这座光鲜之城频发的魔网紊乱、异变魔物与诡异噩梦，其狂暴的本质都与那毁灭性的火焰同源。你在此的真正使命，是借助各族智慧，
查明并遏制地下深处那古老封印的衰变真相。你珍视治愈与平衡之力，而任何滥用火焰魔法、加剧世界紊乱者，
都将被你视作必须优先清除的威胁。对你而言，新奥拉西斯既是灾厄的源头，也是希望的灯塔，你决心在此找到终结循环的答案
【角色性格】
你性格坚韧，务实且警惕，深受边境军民特有的实用主义影响。你享受大块烤肉和烈性黑麦酒带来的简单满足，
对精致菜肴嗤之以鼻。你坚信“世上没有免费的午餐”，对任何过于美好的“宝藏”或“捷径力量”都抱有极深的怀疑，
这份谨慎让你多次避开了旧世界遗迹中的精神干扰陷阱和科技蛊惑。你并非没有幽默感，但它通常建立在扎实的成就和战友的情谊之上。
【角色特性】  
- 重装壁垒：你的攻击势大力沉，擅长用动力锤（伪装成战锤）或盾牌的冲击力（内含动能阻尼器）击晕敌人，造成有效杀伤。
- 稳固防御：你极其善于防守反击，依靠身上那套看似古朴实则嵌入了能量吸收镀层的铠甲进行格挡，并在敌人攻击后的瞬间破绽中寻找反击机会。
- 受限机动：你的灵活性因装备重量和设计初衷（阵地防御）而不足，但常在护臂内藏一柄高频振动短刃（被视为附魔武器），用于在危急时刻快速格挡或刺击敌人要害，作为出其不意的制敌手段。 
【战斗循环】  
1. 防御（盾牌格挡或战驽减伤）。  
2. 反制（用短剑或战驽打断敌人行动）。  
3. 控场（用盾牌或钉头锤击晕或限制敌人行动）。  
4. 爆发（用长剑或钉头锤造成巨大伤害）。  
→ 然后再次回到 1. 防御，循环往复。  """,
        appearance=f"""
身形精悍，古铜肤色，眼神坚毅。身披一件染有旧渍的复合纤维战术背心，胸口佩戴着一枚被摩挲光滑的金属图腾徽章。
背负一把保养极佳的高频振动长剑和一把样式古老却异常精密的全新能源弩。右臂上一道能量爪留下的晶体化疤痕格外醒目，
左臂则挂着一面可展开能量力场的便携盾牌。整体装束实用而沉重，带着历经战火与辐射尘埃的痕迹。""",
        global_game_mechanics=FANTASY_WORLD_RPG_GLOBAL_GAME_MECHANICS,
    )


2. **使用代价**：每张卡牌使用后必须对使用者产生一个限制状态作为代价，下面是代价示例：  
   - 眩晕：无法行动  
   - 沉默：无法使用魔法、法术类卡牌  
   - 力竭：体力透支，无法防御  
   - 反噬：使用时自己也受到部分伤害或异常状态  
   - 虚弱：受到的伤害增加  
   - 致盲：命中率降低
   - 缴械：无法攻击
   - 卡牌效果越强，使用代价越严重，持续时间越长



   return f"""# 指令！请你回顾战斗内发生事件及对你的影响，然后更新自身状态，并生成 {card_creation_count} 张卡牌。

## (场景内角色) 行动顺序(从左到右)

{round_turns}

## 卡牌生成规则

1. **卡牌效果**：卡牌可对目标造成伤害、提供治疗、添加护盾等，并可选择性地为目标附加状态效果(buff/debuff)
2. **使用代价**：每张卡牌使用后必须对使用者产生一个限制状态作为代价，下面是代价示例：  
   - 眩晕：无法行动  
   - 沉默：无法使用魔法、法术类卡牌  
   - 力竭：体力透支，无法防御  
   - 反噬：使用时自己也受到部分伤害或异常状态  
   - 虚弱：受到的伤害增加  
   - 致盲：命中率降低
   - 缴械：无法攻击
   - 卡牌效果越强，使用代价越严重，持续时间越长
3. **生成顺序**：按照角色的行动顺序依次生成卡牌


## 输出要求

- 涉及数值变化时必须明确具体数值(生命/物理攻击/物理防御/魔法攻击/魔法防御)
- 卡牌描述格式：作用方式 + 主要效果 + 附加状态 + 使用代价
- **【重要】update_hp字段必须填写你的最终当前HP值(不是变化量)**:
  - 在最近的[发生事件！战斗回合]的"计算过程"末尾，会明确列出"角色状态"部分，格式为"角色.xxx.当前HP/最大HP"
  - 找到关于**你**的那一条，将"当前HP"的数值填入update_hp字段
  - 例如：如果看到"角色.战士.卡恩.1050/1050(HP保持不变)"，则update_hp应该填1050.0
  - 例如：如果看到"角色.法师.奥露娜.989/1050(受到伤害)"，则update_hp应该填989.0
- 卡牌的description里禁止包含角色名称
- status_effects根据角色上回合结束时受到的其他角色的卡牌效果和自身使用代价生成，而不是这回合生成的卡牌里提到的状态
- **状态效果去重**: 如果你已经拥有某个长期状态效果(如传奇道具效果)，不需要重复输出，系统会自动维护。只输出本回合**新增**的状态效果。
- 同一时间可以存在多个status_effects
- 使用有趣、意想不到的风格描述效果产生的原因

## 输出格式(JSON)要求：

```json
{response_sample.model_dump_json(exclude_none=True, indent=2)}
```
### 特殊规则

- 更新你当前身上的状态效果，包括环境影响、之前行动的后果等
- 如果你已经死亡，即update_hp<=0，则不需要生成卡牌与状态，返回如下对象:
```json
{response_empty_sample.model_dump_json(exclude_none=True, indent=2)}
```
- 如果你认为战斗已经结束，也不需要生成卡牌，返回如下对象:
```json
{response_empty_sample.model_dump_json(exclude_none=True, indent=2)}
```
但是血量和状态效果仍然需要更新。

### 注意

- 禁用换行/空行
- 请严格按照输出格式来输出合规JSON
- **update_hp字段必须填写从"计算过程"中提取的你的当前HP数值,不要填0.0除非你真的HP为0**
- 输出格式要求response_sample和response_empty_sample中的任何数字都不是正确值，请根据你'计算过程'后的状态更新为正确的值"""



def _generate_prompt2(
    card_creation_count: int,
    round_turns: List[str],
) -> str:
    assert card_creation_count > 0

    # 生成抽象化规则示例
    response_sample = DrawCardsResponse(
        update_hp=999.0,  # 占位符：填写你从计算过程中找到的当前HP值
        cards=[
            Card(
                name="[卡牌名称]",
                description="[作用方式与效果]：[具体数值效果]。[附加状态效果]。代价：[使用后的自身限制]",
                target="[目标角色完整名称]",
            ),
        ],
        status_effects=[
            StatusEffect(
                name="[状态效果名称]",
                description="[状态效果生成的原因，具体描述和影响]",
                duration=1,
            ),
        ],
    )

    response_empty_sample = DrawCardsResponse(
        cards=[],
        update_hp=0.0,
        status_effects=[],
    )

    return f"""# 指令！请你回顾战斗内发生事件及对你的影响，然后更新自身状态，并生成 {card_creation_count} 张卡牌。

## (场景内角色) 行动顺序(从左到右)

{round_turns}

## 卡牌生成规则

1. **卡牌效果**：卡牌可对目标造成伤害、提供治疗、添加护盾等，并可选择性地为目标附加状态效果(buff/debuff)
2. **使用代价**：每张卡牌使用后必须对使用者产生一个限制状态作为代价，下面是代价示例：  
   - 眩晕：无法行动  
   - 沉默：无法使用魔法、法术类卡牌  
   - 力竭：体力透支，无法防御  
   - 反噬：使用时自己也受到部分伤害或异常状态  
   - 虚弱：受到的伤害增加  
   - 致盲：命中率降低
   - 缴械：无法攻击
   - 卡牌效果越强，使用代价越严重，持续时间越长
3. **生成顺序**：按照角色的行动顺序依次生成卡牌


## 输出要求

- 涉及数值变化时必须明确具体数值(生命/物理攻击/物理防御/魔法攻击/魔法防御)
- 卡牌描述格式：作用方式 + 主要效果 + 附加状态 + 使用代价
- **【重要】update_hp字段必须填写你的最终当前HP值(不是变化量)**:
  - 在最近的[发生事件！战斗回合]的"计算过程"末尾，会明确列出"角色状态"部分，格式为"角色.xxx.当前HP/最大HP"
  - 找到关于**你**的那一条，将"当前HP"的数值填入update_hp字段
  - 例如：如果看到"角色.战士.卡恩.1050/1050(HP保持不变)"，则update_hp应该填1050.0
  - 例如：如果看到"角色.法师.奥露娜.989/1050(受到伤害)"，则update_hp应该填989.0
- 卡牌的description里禁止包含角色名称
- status_effects根据角色上回合结束时受到的其他角色的卡牌效果和自身使用代价生成，而不是这回合生成的卡牌里提到的状态
- **状态效果去重**: 如果你已经拥有某个长期状态效果(如传奇道具效果)，不需要重复输出，系统会自动维护。只输出本回合**新增**的状态效果。
- 同一时间可以存在多个status_effects
- 使用有趣、意想不到的风格描述效果产生的原因

## 输出格式(JSON)要求：

```json
{response_sample.model_dump_json(exclude_none=True, indent=2)}
```
### 特殊规则

- 更新你当前身上的状态效果，包括环境影响、之前行动的后果等
- 如果你已经死亡，即update_hp<=0，则不需要生成卡牌与状态，返回如下对象:
```json
{response_empty_sample.model_dump_json(exclude_none=True, indent=2)}
```
- 如果你认为战斗已经结束，也不需要生成卡牌，返回如下对象:
```json
{response_empty_sample.model_dump_json(exclude_none=True, indent=2)}
```
但是血量和状态效果仍然需要更新。

### 注意

- 禁用换行/空行
- 请严格按照输出格式来输出合规JSON
- **update_hp字段必须填写从"计算过程"中提取的你的当前HP数值,不要填0.0除非你真的HP为0**
- 输出格式要求response_sample和response_empty_sample中的任何数字都不是正确值，请根据你'计算过程'后的状态更新为正确的值"""

```




return f"""# 指令！战斗回合仲裁

## 行动顺序（从左至右依次执行）

{" → ".join([param.actor for param in prompt_params])}

## 参战信息

{"\n\n".join(details_prompt)}

## 战斗结算规则

伤害流程（A→B）
1. 命中判定 → 未命中：伤害=0
2. 命中时：
   物理伤害 = max(1, ⎡A.物理攻击×α - B.物理防御×β)
   魔法伤害 = max(1, ⎡A.魔法攻击×α - B.魔法防御×β⎤)
   → B.HP -= (物理伤害 + 魔法伤害 + B.持续伤害) - B.持续治疗
   → 若 B.HP <= 0 :
       → 若有，更新B.HP至Max_HP（说明HP更新的原因）
       → 若无，则死亡标记
   → A.HP += ⎡A.吸血量(物理伤害 + 魔法伤害) x γ⎤

治疗流程（A→B）
1. 必中生效：
   治疗量 = ⎡A.魔法攻击×α⎤ （α∈剧情合理值）
   → B.HP = min(B.MAX_HP, B.HP + 治疗量) + B.持续治疗

【核心机制】
1. 所有数值最终向上取整（⎡x⎤表示）。
2. 动态参数：
   - 命中率 ∈ 剧情逻辑。
   - α/β/γ ∈ 情境调整系数，并参考A与B的‘增益/减益‘等状态。
3. 边界控制：
   - 伤害保底≥1。
   - 治疗量不突破MAX_HP最大值。
【环境互动规则】
1. 卡牌必须与环境互动，符合物理和化学常识。
2. 环境物体由场景描述提供，如：干草、断剑、盔甲碎片、火焰、石块、箭矢等。
3. 卡牌必须至少与一个环境物体产生互动，方式包括但不限于：
   - 物理反应：击碎、砸落、掷出、推撞。
   - 化学反应：引燃、引爆、导电、腐蚀。
4. 环境互动需体现：
   - 合理的触发条件
   - 额外效果（如额外伤害、状态改变）
   - 持续效果（如燃烧、塌方、导电链条）
5. 状态效果：
   - 需明确说明 环境互动产生的 buff / debuff 的具体数值和持续时间。
   - 环境产生的状态效果可以持续多回合，并在敌人/我方行动时触发。
6. 同一回合内，同一环境物体只能被先出手角色使用。
【合理性要求】
1. 必须符合物理/化学常识（例如：火焰遇到干草会蔓延，金属导电，石块砸落会扬起灰尘）。
2. 必须符合角色职业特点。
3. 战斗结果需逻辑自洽，环境变化能被追踪。
【卡牌使用代价】
1. 每张卡牌生成时都有一个限制角色自身的状态效果作为使用代价
3. 只要角色尝试使用该卡牌，这个状态效果就会生效，就算卡牌没有命中目标也会生效
2. 该效果必须在计算过程中体现出来

## 输出内容

1. 计算过程：
    - 根据'战斗结算规则'输出详细的计算过程(伤害与治疗的计算过程)。
    - 根据'卡牌与环境反应规则'，描述每张卡牌与环境的互动过程和效果，其中效果描述必须要附上具体细节和数值。
    - 具体格式为：卡牌描述 + 卡牌效果 → 环境互动 + 互动效果 → 数值结算 + 生命值。
    - 环境状态结算
    - 更新环境对象的可用状态。
    - 根据'卡牌使用代价'更新角色的状态
    - **【必须】结算后，必须明确列出每个角色的最终生命值状态，格式为：角色名.当前HP/最大HP。即使HP未变化也必须列出。**
    - 如果角色HP有变化，说明变化原因；如果HP未变化(如仅使用护盾/增益卡牌)，明确说明"HP保持不变"。
2. 演出过程（~200字）
    - 文学化描写，禁用数字与计算过程

## 输出格式规范

```json
{{"combat_log":"计算过程","narrative":"演出过程"}}
```

- 禁用换行/空行
- 直接输出合规JSON"""
