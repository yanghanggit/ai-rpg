from pathlib import Path
from dataclasses import dataclass
from ..game.tcg_game_config import GEN_RUNTIME_DIR, GEN_WORLD_DIR
import shutil


###############################################################################################################################################
###############################################################################################################################################
###############################################################################################################################################
@dataclass
class UserSessionOptions:

    user: str
    game: str
    actor: str

    ###############################################################################################################################################
    # 生成用户的运行时目录
    @property
    def world_runtime_dir(self) -> Path:

        dir = GEN_RUNTIME_DIR / self.user / self.game
        if not dir.exists():
            dir.mkdir(parents=True, exist_ok=True)

        assert dir.exists()
        assert dir.is_dir()
        return dir

    ###############################################################################################################################################
    # 生成用户的运行时文件
    @property
    def world_runtime_file(self) -> Path:
        return self.world_runtime_dir / f"runtime.json"

    ###############################################################################################################################################
    # 生成用户的运行时文件
    @property
    def world_runtime_boot_file(self) -> Path:
        return self.world_runtime_dir / f"{self.game}.json"

    ###############################################################################################################################################
    # 生成用户的运行时文件
    @property
    def gen_world_boot_file(self) -> Path:
        return GEN_WORLD_DIR / f"{self.game}.json"

    ###############################################################################################################################################
    # 清除用户的运行时目录, 重新生成
    def clear_runtime_dir(self) -> None:
        # 强制删除一次
        if self.world_runtime_dir.exists():
            shutil.rmtree(self.world_runtime_dir)
        # 创建目录
        self.world_runtime_dir.mkdir(parents=True, exist_ok=True)
        assert self.world_runtime_dir.exists()


###############################################################################################################################################
###############################################################################################################################################
###############################################################################################################################################
@dataclass
class TerminalUserSessionOptions(UserSessionOptions):
    debug_enforce_new_game: bool


###############################################################################################################################################
###############################################################################################################################################
###############################################################################################################################################
@dataclass
class WebUserSessionOptions(UserSessionOptions):
    pass
