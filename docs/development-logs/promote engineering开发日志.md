# 多智能体游戏框架改进清单

## 📋 待改进问题

### 1. 环境交互系统问题

#### 1.1 交互逻辑不合理
- **问题描述**：角色无法智能地利用可交互物体，某些交互行为显得不符合逻辑
- **具体表现**：部分交互操作缺乏合理性，影响游戏体验

#### 1.2 强制交互行为
- **问题描述**：角色会强制与环境物体交互，不符合角色特性
- **举例说明**：战士角色没有远程攻击能力，却能凭空触发摇摇欲坠的石头掉落
- **影响范围**：破坏了角色职业特色的一致性

#### 1.3 交互状态重复
- **问题描述**：已交互过的物体会重复出现交互选项
- **当前状态**：经过修改后有所改善，但仍需进一步优化

#### 1.4 抽卡系统职业适配性
- **问题描述**：虽然可以针对不同职业设置抽卡偏好，但限制过于简单
- **待解决**：如何让角色根据自身特点和环境状况选择合适的抽卡策略

### 2. 角色技能系统问题

#### 2.1 角色混乱问题
- **问题描述**：出现角色身份混乱，抽取技能与角色不匹配的情况
- **重要发现**：抽卡提示词直接限制角色抽卡模式会导致角色混乱

#### 2.2 环境交互技能生成异常
- **问题描述**：抽卡提示词可能强制让不具备环境交互能力的角色生成环境交互技能
- **需要改进**：优化提示词逻辑，确保技能生成符合角色定位

#### 2.3 演出效果优化需求
- **改进方向**：修改演出提示词，增强技能与环境交互的视觉效果

#### 2.4 技能生成效果
- **问题描述**：想要让技能按照角色的战斗循环进行生成，名字和具体效果不同，但是作用相似，比如战士的循环是会先眩晕敌人在攻击，然后防守反击再轻攻击打断敌人给自己调整时间。
- **目前进度**：技能生成基本会按照战斗循环进行生成，但是中间也会有一些其他技能莫名生成，整体上不会太影响循环的效果。

#### 2.5 技能的优缺点生成
- **问题描述**：想要为每个技能添加其优点和缺点，就是使用这个技能的好处是什么，坏处是什么
- **目前进度**：如果让玩家自己选的话我觉得取舍最基本的就是根据敌人的行动决定攻击还是防守，如果抽到两个攻击或防御牌那就是根据不同的效果决定最合适的牌。目前能在抽卡中形成的优缺点就是使用这张卡会额外获得的增益和减益，比如使用反击姿态会增加防御但是减少速度。

### 3 环境互动提示词修改历程
- **问题描述**：环境互动提示词首先放置的位置是在抽卡提示词里的，因为想要让角色与环境互动所以一开始的想法是在抽卡时生成一个角色观察环境并利用环境的技能，这个技能会让角色利用环境元素，如点燃干草，击落石头等等间接方式来攻击敌人，但是效果一直不好，并且出现了上述这些问题。
- **修改1**：最开始是在抽卡提示词中添加生成环境技能的提示词，虽然所有角色都有一个技能是和环境互动，但是缺少灵活性，并且每个角色互动的效果和描述基本一样
- **修改2**：为了增加灵活性和多样性，在抽卡提示词中增加了生成模式，意在让不同的角色使用不同的生成模式，这样可以让角色生成技能时根据不同的性格和特点来生成和环境的互动，但是效果不好，并且产生了角色技能混乱
- **修改3**：放弃在抽卡提示词中使用环境互动，而是在角色的system message里添加和环境的互动机制，虽然可以触发环境互动，但是因为没有添加环境互动规则所以导致环境互动效果很差，但是如果要添加的话，在角色system message里会太臃肿。
- **修改4**：经过思考决定尝试在演出提示词里添加和环境互动的提示词，结果比之前的几次尝试都要好，技能与环境互动会产生效果，并且因为每个角色的技能不同，所以和环境产生的效果也不同。但是有一点问题就是触发环境互动有时只是描写了和环境有互动，但是没有实际的效果。
- **最后修改（暂时）**：在演出提示词中对环境互动提示词进行优化，添加了环境互动的规则，环境互动的计算流程。修改后的环境互动更加符合逻辑，更加合理，并且互动的结果有具体的效果和数值。经过这一系列的修改，我认为首先提示词在抽卡这个系统里修改没法很好的实现是因为抽卡这个是统一的，所以在没有限制的情况下所有角色都是相同的，因此生成的环境互动效果也是相同的。第二，在抽卡系统中添加分类虽然让不同角色有不同的生成模式，但是不稳定，没法确定AI下一次的运行会生成相同的效果，因为提示词里的限制。在思考后认为和环境的互动其实是因为技能在释放后可能会和环境中的某些东西产生反应，而这一过程应该是在表演和结算技能效果部分，而不是在一开始就限制，所以选择在导演系统中来让技能和环境产生互动，符合逻辑顺序。因此，这次改动让整个环境互动的效果更好了。

### 4.角色状态问题
- **问题描述**：有些技能提到的如增加/减少 防御/攻击力这种效果时角色的属性似乎没有改变，每次抽卡前会列出角色的属性，但是除了生命值会按所说的产生变化，其他的似乎都没有真的变化。角色身上状态只会挂着刚进入地下城的初始状态，每个回合结算之后身上的状态会更新，但是每个回合开始身上的状态不会更新为上一回合结束时的状态。

## 🔍 有趣发现

### 4. 系统自我保护机制
- **现象**：可以设置角色不生成任何技能，但会导致后续错误
- **案例分析**：训练机器人时出现的bug（生成战士和法师技能）源于系统的自我保护机制
- **推测**：当设置"不生成技能"时，系统为避免崩溃会强制生成技能

### 5. 技能质量递减现象
- **观察结果**：第一回合生成的技能通常非常合理
- **问题趋势**：随着回合推进，技能生成质量逐渐下降
- **需要研究**：找出质量递减的根本原因

### 6. 角色外观更新
**现象**；训练机器人手上的棍子被烧了，下回合不会再用棍子
**问题**；好的结果，但是角色的appearance不会更新，如果再开始，训练机器人手上还会有棍子。

## 💡 创新设想

### 6. 环境感知战斗系统
- **核心理念**：战斗前进行环境观察和分析
- **实现流程**：
  1. 战斗开始前扫描可交互环境元素
  2. 玩家选择交互方式：
     - 直接与环境元素交互
     - 使用技能配合环境元素交互
  3. 执行交互判定和效果计算

## 📊 优先级排序

| 优先级 | 问题类别 | 影响程度 | 实现难度 |
|--------|----------|----------|----------|
| 🔴 高 | 角色混乱问题 | 严重 | 中等 |
| 🟡 中 | 强制交互行为 | 中等 | 较低 |
| 🟡 中 | 技能质量递减 | 中等 | 较高 |
| 🟢 低 | 演出效果优化 | 较低 | 较低 |

## 📝 后续计划

1. **短期目标**：解决角色混乱和强制交互问题
2. **中期目标**：实现环境感知战斗系统原型
3. **长期目标**：建立完整的智能交互生态系统