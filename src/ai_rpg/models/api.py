from enum import StrEnum, unique
from typing import Dict, List, final
from pydantic import BaseModel
from .session_message import SessionMessage
from .dungeon import Dungeon
from .serialization import EntitySerialization
from .task import TaskRecord
from .world import Blueprint

################################################################################################################
################################################################################################################
################################################################################################################


@final
class RootResponse(BaseModel):
    service: str
    description: str
    version: str
    status: str
    timestamp: str
    endpoints: Dict[str, str]
    api_docs: Dict[str, str]


################################################################################################################
################################################################################################################
################################################################################################################


@final
class LoginRequest(BaseModel):
    user_name: str
    game_name: str


@final
class LoginResponse(BaseModel):
    message: str


################################################################################################################
################################################################################################################
################################################################################################################


@final
class LogoutRequest(BaseModel):
    user_name: str
    game_name: str


@final
class LogoutResponse(BaseModel):
    message: str


################################################################################################################
################################################################################################################
################################################################################################################


@final
class StartRequest(BaseModel):
    user_name: str
    game_name: str


@final
class StartResponse(BaseModel):
    blueprint: Blueprint


################################################################################################################
################################################################################################################
################################################################################################################


@final
class HomeAdvanceRequest(BaseModel):
    user_name: str
    game_name: str
    actors: List[str] = []


@final
class HomeAdvanceResponse(BaseModel):
    session_messages: List[SessionMessage]


################################################################################################################
################################################################################################################
################################################################################################################


@final
class HomeTransDungeonRequest(BaseModel):
    user_name: str
    game_name: str


@final
class HomeTransDungeonResponse(BaseModel):
    message: str


################################################################################################################
################################################################################################################
################################################################################################################
@final
class DungeonTransHomeRequest(BaseModel):
    user_name: str
    game_name: str


@final
class DungeonTransHomeResponse(BaseModel):
    message: str


################################################################################################################
################################################################################################################
################################################################################################################


@final
@unique
class HomePlayerActionType(StrEnum):
    SPEAK = "/speak"
    SWITCH_STAGE = "/switch_stage"


@final
class HomePlayerActionRequest(BaseModel):
    user_name: str
    game_name: str
    action: HomePlayerActionType
    arguments: Dict[str, str]


@final
class HomePlayerActionResponse(BaseModel):
    session_messages: List[SessionMessage]


################################################################################################################
################################################################################################################
################################################################################################################


@final
class DungeonGamePlayUserInput(BaseModel):
    tag: str
    data: Dict[str, str]


@final
class DungeonGamePlayRequest(BaseModel):
    user_name: str
    game_name: str
    user_input: DungeonGamePlayUserInput


@final
class DungeonGamePlayResponse(BaseModel):
    session_messages: List[SessionMessage]


################################################################################################################
################################################################################################################
################################################################################################################


@final
class DungeonCombatPlayCardsRequest(BaseModel):
    user_name: str
    game_name: str


@final
class DungeonCombatPlayCardsResponse(BaseModel):
    task_id: str
    status: str
    message: str


################################################################################################################
################################################################################################################
################################################################################################################


@final
class DungeonStateResponse(BaseModel):
    mapping: Dict[str, List[str]]
    dungeon: Dungeon


################################################################################################################
################################################################################################################
################################################################################################################


@final
class StagesStateResponse(BaseModel):
    mapping: Dict[str, List[str]]


################################################################################################################
################################################################################################################
################################################################################################################


@final
class EntitiesDetailsResponse(BaseModel):
    entities_serialization: List[EntitySerialization]


################################################################################################################
################################################################################################################
################################################################################################################


@final
class SessionMessageResponse(BaseModel):
    session_messages: List[SessionMessage]


################################################################################################################
################################################################################################################
################################################################################################################


@final
class TaskTriggerResponse(BaseModel):
    task_id: str
    status: str
    message: str


@final
class TasksStatusResponse(BaseModel):
    tasks: List[TaskRecord]
