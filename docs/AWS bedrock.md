# AWS Bedrock 配置指南

## IAM用户创建和权限配置

### 为什么要使用IAM用户而不是Root账号？

使用IAM用户是AWS的最佳安全实践，原因如下：

- **最小权限原则**：只授予必要的权限
- **审计和监控**：更好地跟踪操作记录
- **安全性**：降低Root账号泄露的风险
- **团队协作**：便于为不同的人员分配不同的权限

### 步骤1：登录AWS控制台

1. 使用你的Root账号登录 [AWS管理控制台](https://console.aws.amazon.com/)
2. 在搜索框中输入"IAM"并点击进入IAM服务

### 步骤2：创建IAM用户

1. 在IAM控制台左侧菜单中，点击 **"Users"（用户）**
2. 点击 **"Create user"（创建用户）**按钮
3. 填写用户详细信息：
   - **User name（用户名）**：建议使用有意义的名称，如 `game-developer-main`
   - 勾选 **"Provide user access to the AWS Management Console"**（为用户提供AWS管理控制台访问权限）
   - **Console password（控制台密码）**：选择 "Autogenerated password"（自动生成密码）或 "Custom password"（自定义密码）
   - 建议勾选 **"Users must create a new password at next sign-in"**（用户下次登录时必须创建新密码）

### 步骤3：分配权限

有两种方式分配权限，推荐使用**策略组**的方式：

#### 方式1：直接附加策略（推荐用于开始）

1. 在 **"Set permissions"** 页面，选择 **"Attach policies directly"**
2. 搜索并选择以下AWS托管策略：
   - **AmazonEC2FullAccess**：EC2完全访问权限
   - **AmazonBedrockFullAccess**：Bedrock完全访问权限
   - **IAMReadOnlyAccess**：IAM只读权限（用于查看自己的权限）

#### 方式2：创建用户组（推荐用于长期使用）

1. 先创建用户组：
   - 在IAM控制台点击 **"User groups"**
   - 点击 **"Create group"**
   - 组名：`developers`
   - 附加相同的策略：`AmazonEC2FullAccess`, `AmazonBedrockFullAccess`, `IAMReadOnlyAccess`
2. 将用户添加到组中

### 步骤4：完成创建

1. 审查所有设置
2. 点击 **"Create user"**
3. **重要**：保存登录信息
   - 控制台登录链接
   - 用户名
   - 临时密码（如果是自动生成的）

### 步骤5：配置多因素认证（MFA）- 强烈推荐

1. 创建用户后，点击用户名进入用户详情页
2. 点击 **"Security credentials"** 标签
3. 在 **"Multi-factor authentication (MFA)"** 部分点击 **"Assign MFA device"**
4. 选择 **"Authenticator app"**（推荐使用Google Authenticator或Microsoft Authenticator）
5. 按照指引完成MFA设置

### 步骤6：测试IAM用户登录

1. 退出Root账号
2. 使用IAM用户的登录链接登录（格式通常是：`https://your-account-id.signin.aws.amazon.com/console`）
3. 输入IAM用户名和密码
4. 如果设置了MFA，输入验证码
5. 测试访问EC2和Bedrock服务

## 权限说明

### 当前分配的权限

- **AmazonEC2FullAccess**：
  - 启动、停止、终止EC2实例
  - 创建和管理安全组、密钥对
  - 管理EBS卷和快照
  - 查看所有EC2资源

- **AmazonBedrockFullAccess**：
  - 访问所有Bedrock模型
  - 创建和管理模型训练作业
  - 管理Bedrock资源

- **IAMReadOnlyAccess**：
  - 查看IAM用户、组和策略
  - 不能修改IAM资源（安全考虑）

### 后续权限优化建议

随着你对AWS服务的熟悉，建议：

1. **使用更细粒度的权限**：
   - 替换FullAccess策略为更具体的权限
   - 只授予实际需要的操作权限

2. **创建自定义策略**：

   ```json
   {
     "Version": "2012-10-17",
     "Statement": [
       {
         "Effect": "Allow",
         "Action": [
           "ec2:DescribeInstances",
           "ec2:StartInstances",
           "ec2:StopInstances"
         ],
         "Resource": "*"
       }
     ]
   }
   ```

3. **使用资源级权限**：
   - 限制只能操作特定的资源
   - 使用标签进行权限控制

## 安全最佳实践

1. **定期轮换密码**
2. **启用CloudTrail**：记录所有API调用
3. **使用最小权限原则**
4. **定期审查权限**
5. **不要在代码中硬编码访问密钥**

## 常见问题

### Q: 忘记IAM用户密码怎么办？

A: 使用Root账号登录，在IAM控制台重置IAM用户密码。

### Q: 如何获取程序化访问权限（Access Key）？

A: 在IAM用户的"Security credentials"标签下创建Access Key，用于CLI和SDK访问。

### Q: 权限不足错误怎么解决？

A: 检查用户或组的策略，确保包含所需的权限。可以使用IAM Policy Simulator测试权限。
