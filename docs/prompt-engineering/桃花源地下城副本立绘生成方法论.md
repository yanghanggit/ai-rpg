# 地下城副本立绘生成方法论

## 核心原则

从 Dungeon 代码生成包含场景与角色的副本立绘：

- **立绘单位**：一个 Stage（场景） + 该场景内的 Actors（角色/怪物） = 一张立绘
- **输入**：stage.stage_profile（场景描述） + actors[].character_sheet（所有角色外观）
- **输出**：正向提示词 + 负向提示词
- **副本多场景**：若 Dungeon 包含 N 个场景，则生成 N 张立绘
- **继承**：基于场景7段式模板，在其中插入角色描述段

---

## 副本立绘特点

| 维度 | 纯场景立绘 | 副本立绘 |
| --- | --- | --- |
| 立绘内容 | 纯环境氛围 | 环境 + 场景内所有角色/怪物 |
| 画面焦点 | 空旷场景 | 有明确视觉焦点（角色） |
| 构图原则 | 环境充满画面 | 角色为主体，与环境平衡 |

**角色数量处理**：

- **单个角色**：作为中景主体，位置根据场景开阔度选择
- **多个角色**：主要角色居中/偏前，次要角色散布于场景中

**角色位置策略**：

- 开阔场地 → 中景偏右/偏左
- 封闭空间 → 中景居中

---

## 固定参数

- **尺寸**：768 x 1344（竖屏 9:16）
- **生成模型**：Gemini 2.5 Flash Image (nano-banana)
- **艺术风格**：像素游戏风格
- **推理步数**：4
- **引导比例**：7.5
- **视角要求**：与场景类型一致（室内正面平视 / 室外地面平视）

---

## 提示词模板

### 室外副本（7+1段式）

```text
像素艺术风格，16位复古游戏美术，竖幅构图，纯背景插画艺术作品，地面平视角度，角色站在地面的第一人称视角。

[世界观设定]的[场景名称]，[场景规模/级别]，像素化的[场景主体描述]，角色站立在地面的视角高度，看向前方地平线。

像素化的[建筑元素描述]，[建筑工艺/风格特点]，[建筑规模/层数]，从地面平视看建筑。

像素化的[环境元素描述]，[场景氛围描述]，清晰的像素轮廓，地面平视透视。

像素化的[角色1名称]位于[位置1]，[材质结构]，[外观特征]，[细节描述]，[姿态状态]，清晰的像素轮廓。[若有角色2]像素化的[角色2名称]位于[位置2]，[外观描述]，[姿态状态]。地面平视透视。

像素[光源描述]，营造[氛围感受]。

经典像素艺术技法，使用有限的色板，以像素化的方式表现空间层次，[色调描述]，[场景风格总结]，地面水平视角。

前景[近处地面细节]，中景[所有角色]+[场景核心元素]，背景[远景虚化/天空/远山]，地平线在画面中上部。画面氛围[形容词]，但不出现场景外其他人物。竖向像素游戏背景构图，环境像素化刻画精细，严格地面平视角度看向前方，完全禁止从上往下俯视，不显示布局鸟瞰图。[场景规模描述]。纯粹的像素背景艺术，无任何文字、标题、按钮或界面元素。16位像素艺术风格，复古游戏美学，竖向构图。
```

### 室内副本（7+1段式）

```text
像素艺术风格，16位复古游戏美术，竖幅构图，纯背景插画艺术作品，室内正面平视视角，第一人称进入室内的视角。

[世界观设定]的[场景名称]，[建筑规模/级别]的建筑室内，像素化的[建筑描述]，[建筑内部特征]，纯室内封闭场景，完整的屋顶覆盖顶部，正面看向室内深处。

像素化的[墙壁、支撑结构、屋顶、地板、门窗]，[建筑工艺/风格描述]，[空间规模描述]，完全封闭的室内空间，四周完整墙壁围合，顶部完整屋顶覆盖，看不到任何外部天空，正面室内透视构图。

像素化的[室内物品陈设描述]，[家具/道具风格描述]，清晰的像素轮廓，物品正面摆放在室内。

像素化的[角色1名称]位于[位置1]，[外观描述]，[姿态状态]，在室内环境中[动作/状态]，清晰的像素轮廓。[若有角色2]像素化的[角色2名称]位于[位置2]，[外观描述]，[姿态状态]。室内光影效果。

像素[室内光源描述]和[装饰物描述]，营造[氛围]。

经典像素艺术技法，使用有限的色板，以像素化的方式表现室内空间层次，[色调]，[场景风格总结]，正面进入室内的透视感。

前景[近处物品]，中景[所有角色]+[整体空间]，背景[室内墙壁和完整屋顶结构]。画面氛围[形容词]，但不出现场景外其他人物。竖向像素游戏背景构图，建筑和物品像素化刻画精细，正面室内视角充满画面，顶部有完整屋顶覆盖，不显示任何外部景色天空云朵，室内场景铺满整个画面无大面积留白。[场景规模描述]。纯粹的像素背景艺术，无任何文字、标题、按钮或界面元素。16位像素艺术风格，复古游戏美学，竖向构图。
```

### 负向提示词（副本专用）

**基础负向**（通用）：

```text
人物，人脸，角色，村民，现代元素，现代建筑，玻璃窗，3D渲染，照片写实，高清，抗锯齿，平滑，模糊，渐变，油画，水彩，水墨画，素描，手绘，卡通风格，动漫，西方建筑，构图杂乱，文字，汉字，英文字母，标志，logo，标题，游戏标题，按钮，UI界面，游戏界面，START，PLAY，框架，边框，装饰框，红框，过度饱和，柔和边缘，圆滑，城镇，城市，宏伟建筑，多层建筑，高楼，城楼，城墙，宫殿，庙宇，飞檐斗拱，华丽装饰，精致雕刻，复杂屋顶，建筑群，密集建筑，城市化，豪华，grand architecture，palace，temple，urban
```

**副本特殊负向**（防止多角色）：

```text
多个角色，多个人物，玩家角色，猎人角色，额外人物，crowds，multiple characters，人脸特写
```

**视角控制负向**（室外场景必须添加）：

```text
bird's eye view，overhead view，top-down view，map view，isometric view，floor plan，layout diagram，aerial perspective，looking down from above，俯瞰视角，鸟瞰图，平面布局图，地图视角，等轴测视角，从上往下看，鸟瞰透视，俯视图，村落全景俯视，多个建筑俯视布局，village layout，aerial view of village，multiple buildings from above，同时看到多个屋顶
```

**室内额外负向**（室内场景必须添加）：

```text
天空，蓝天，云朵，云彩，户外，外部景色，窗外景色，桃花林，树木，山脉，开放空间，露天，室外，阳光直射，日光，sky，blue sky，clouds，outdoor，open air，exterior，sunlight，等轴测视角，剖面图，横截面，建筑剖面，cutaway view，cross-section view，isometric view，diorama，model view，architectural section，building cutaway，侧面剖开，透视剖面，留白过多，空白边缘
```

---

## 执行命令

```bash
# 激活环境
source .venv/bin/activate

# 执行生成
python scripts/run_replicate_test_text2image.py \
  "[正向提示词]" \
  --width 768 \
  --height 1344 \
  --negative "[负向提示词]" \
  --steps 4 \
  --guidance 7.5
```

---

## 关键约束

1. **一张立绘对应**：一个 Stage + 该 Stage.actors 中的所有角色
2. **角色描述段位置**：在第5段（场景环境段之后，光源段之前）
3. **多角色处理**：若场景有多个角色，在第5段中依次描述，主要角色详细，次要角色简略
4. **角色描述结构**：`[材质] + [结构] + [外观特征] + [细节] + [姿态]`
5. **负向提示词组合**：基础负向 + 副本特殊负向 + 视角控制负向（室外） / 室内额外负向（室内）
6. **视角一致性**：角色描述必须包含与场景相同的视角透视关键词
7. **细节平衡**：场景3-4句，单个角色2-3句，多角色按重要性分配

---

**版本**：v1.1  
**更新日期**：2026-01-13  
**适用范围**：通用地下城副本立绘生成  
**依赖文档**：场景7段式提示词生成方法论
